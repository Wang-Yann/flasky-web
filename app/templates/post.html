{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Flasky - Post{% endblock %}

{% block page_content %}
<div class="post-box">

	<div class="post-entry-header">
		<h3 class="post-entry-title">
			{{post.title}}
		</h3>
    </div>

    <div class="post-entry-info">
		<div class="left-info">
			<span class="label label-default">{{ moment(post.timestamp).format('LL') }}</span>&nbsp;

			{% for tag in post.tags %}
				<span class="label label-success">{{tag.tag_name}}</span>&nbsp;
			{% endfor %}
		</div>
		<div class="right-info">
			<span class="label label-info">浏览{{post.read_count}}</span>
			<span class="label label-info">评论{{ post.comments.count() }}</span>
		</div>
	</div>
    
    <div class="post-body">
        {% if post.body_html %}
               {{ post.body_html | safe }}
        {% else %}
               {{ post.body }}
        {% endif %}
    </div>

	
    <div class="post-footer">
		<div class="left-info">
			<p>
			<button type="button" class="btn btn-default btn-sm" >
				<span class="glyphicon glyphicon-user"></span> 
					<a href="{{ url_for('.user', username=post.author.username) }}">{{post.author.username}}</a>
			</button>
			</p>
			<p> <span class="glyphicon glyphicon-time">更新时间：</span>
				{{moment(post.update_time).format('LL')}}
			</p>
		</div>
		
		<div class="right-info ">
            {% if current_user.is_concerning(post) %}
			<button type="button" class="btn btn-default btn-sm ">
				<a href="{{ url_for('.unconcern', post_id=post.id) }}">
                    <span class="glyphicon glyphicon-star "></span> 
                取消收藏 | {{post.users.count()}}    
                </a>
                
			</button>
            {% else %}
            <button type="button" class="btn btn-default btn-sm ">
				<a href="{{ url_for('.concern', post_id=post.id) }}">
                    <span class="glyphicon glyphicon-star-empty"></span> 
                     收藏 | {{post.users.count()}}
                </a>
			</button>
            {% endif %}
            
			<button type="button" class="btn btn-default btn-sm ">
                <a href="{{ url_for('.vote', post_id=post.id) }}">
                    <span class="glyphicon glyphicon-thumbs-up"></span> 喜欢 | {{post.remark_count}}
                </a>
			</button>
				
		</div>
    </div>
	



<hr>

	<div>
		    
    <h5 id="comments"><span class="glyphicon glyphicon-comment">评论</span></h5>
        {% include '_comments.html' %}
        
        <div class="pagination">
            {{ macros.pagination_widget(pagination, '.post', fragment='#comments', id=id) }}
        </div>
    
	</div>
	<hr>
	
	<div >
	<h4  id="submit-comment"><span class="glyphicon glyphicon-comment">发表评论</span></h4>
        <!-- {% if current_user.can(Permission.COMMENT) %} -->
        {% include '_submit_comment.html' %}    
        <!-- {% endif %} -->
	</div>

	
    <div>
        <!-- article sharing: use baidu share lib: http://share.baidu.com/code -->
        <div class="bdsharebuttonbox pull-left">
            <a href="#" class="bds_more" data-cmd="more"></a>
            <a href="#" class="bds_qzone" data-cmd="qzone"></a>
            <a href="#" class="bds_tsina" data-cmd="tsina"></a>
            <a href="#" class="bds_tqq" data-cmd="tqq"></a>
            <a href="#" class="bds_renren" data-cmd="renren"></a>
            <a href="#" class="bds_weixin" data-cmd="weixin"></a>
        </div>
        {% if current_user == post.author %}
        <div class="btn-group col-sm-offset-2">
            <a href="{{ url_for('.post_edit', id=id) }}" target="_blank" class="btn btn-warning" 
                role="button" id="post_edit">编辑</a>
            <a href="{{ url_for('.delete', id=id) }}" class="btn btn-danger" role="button" id="post_del">删除</a>
        </div>
        {% elif current_user.is_administrator() %}
        <div class="btn-group col-sm-offset-2">
            <a href="{{ url_for('.post_edit', id=id) }}" target="_blank" class="btn btn-warning" 
                role="button" id="post_edit">编辑[Admin]</a>
            <a href="{{ url_for('.delete', id=id) }}" class="btn btn-danger" role="button" id="post_del">删除[Admin]</a>
        </div>
         
        {% endif %}
    </div>
    
    <br/>
</div>
{% endblock %}


















{% block stylesheet %}
    {{ super() }}
    <link href="{{ url_for('static', filename='css/prism.css') }}" rel="stylesheet">
{% endblock %}


{% block scripts %}
	{{ super() }}
	<!-- <script>
	$(document).ready(function () {
		$("#button").click(function (){
                $('html, body').animate({
                    scrollTop: $("#submit-comment").offset().top
                }, 800);
            });
	});
	</script> -->
	<script src="{{ url_for('static', filename='tinymce/js/tinymce/extentsion_self/codesimple_extentsion/prism.js') }}"> </script>
    <!-- <script src="{{ url_for('static', filename='js/admin.js') }}"></script> -->
    <script src="{{ url_for('static', filename='js/commentReply.js') }}"> </script>

    <!-- article sharing: use baidu share lib: http://share.baidu.com/code -->
    <script>
        window._bd_share_config={
            "common":{
                "bdSnsKey":{},
                "bdText":"",
                "bdMini":"2",
                "bdPic":"",
                "bdStyle":"0",
                "bdSize":"16"},
            "share":{},
            "image":{
                "viewList":["qzone","tsina","tqq","renren","weixin"],
                "viewText":"分享到：",
                "viewSize":"16"},
            "selectShare":{
                "bdContainerClass":null,
                "bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]
            }};

        with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>
{% endblock %} 

